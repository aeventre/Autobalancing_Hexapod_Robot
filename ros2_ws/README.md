# Software Design
## ROS2 Package Overview
### 1. **Support Polygon Calculator**
- **Purpose**:  
  Calculates the support polygon, centroid, and stability margin based on grounded foot positions and the center of mass (CoM).

- **Key Components**:  
  - `support_polygon_calculator.cpp`: Implements the core logic for polygon computation and stability margin calculation.  
  - `math_utils.hpp/cpp`: Shared utility functions for geometric and mathematical operations.  
  - `support_polygon_calculator.launch.py`: Simplifies launching the node with appropriate parameters.  

- **Subscribed Topics**:  
  - `/grounded_foot_positions` (geometry_msgs/Polygon): Foot positions currently in contact with the ground.  
  - `/center_of_mass` (geometry_msgs/Point): CoM position of the robot.  

- **Published Topics**:  
  - `/support_polygon` (geometry_msgs/PolygonStamped): The computed support polygon.  
  - `/polygon_centroid` (geometry_msgs/Point): Centroid of the support polygon.  
  - `/stability_margin` (std_msgs/Float32): Stability margin of the robot.  

---

### 2. **Servo Control**
- **Purpose**:  
  Controls the servos to execute gait transitions and posture adjustments.

- **Key Components**:  
  - `servo_controller.cpp`: Implements PWM signal generation and servo control logic.  
  - `servo_settings.yaml`: Configures servo-specific parameters like offsets, limits, and joint IDs.  
  - `servo_control.launch.py`: Launch file for easy startup.  

- **Subscribed Topics**:  
  - `/trajectory_commands` (custom or std_msgs): Commands for joint positions or PWM values.  

- **Published Topics**:  
  - None (controls servos directly).  

---

### 3. **IMU Interface**
- **Purpose**:  
  Reads IMU data to provide orientation and balance feedback.

- **Key Components**:  
  - `imu_interface.cpp`: Interfaces with the IMU hardware to publish orientation and acceleration data.  
  - `imu_settings.yaml`: Contains filtering parameters and IMU-specific settings.  
  - `imu_interface.launch.py`: Simplifies starting the node.  

- **Published Topics**:  
  - `/imu_data` (sensor_msgs/Imu): Filtered IMU data for other nodes.  

---

### 4. **Foot Sensor Package**
- **Purpose**:  
  Monitors foot contact sensors to determine which feet are grounded.

- **Key Components**:  
  - `foot_sensor.cpp`: Implements sensor reading and contact detection logic.  
  - `foot_sensor.launch.py`: Launch file for the sensor node.  

- **Published Topics**:  
  - `/grounded_foot_positions` (geometry_msgs/Polygon): Positions of grounded feet.  

- **Subscribed Topics**:  
  - None (directly interfaces with sensors).  

---

### 5. **Static Balancing Package**
- **Purpose**:  
  Adjusts the robot's posture to maintain stability when stationary, based on feedback from the support polygon and foot sensors.

- **Key Components**:  
  - `static_balancer.cpp`: Computes joint adjustments to keep the CoM within the support polygon.  
  - `static_balancer.launch.py`: Launch file for the balancing node.  

- **Subscribed Topics**:  
  - `/support_polygon` (geometry_msgs/PolygonStamped): The computed support polygon.  
  - `/center_of_mass` (geometry_msgs/Point): Position of the CoM.  
  - `/grounded_foot_positions` (geometry_msgs/Polygon): Positions of grounded feet.  

- **Published Topics**:  
  - `/balancing_commands` (custom or std_msgs): Adjustments for servo control to maintain balance.  

## ROS2 Topic List


1. **`/joint_angles`**
   - **Type**: `hexapod_msgs/JointAngles`
   - **Purpose**: Commands or approximations of joint angles for all servos.

2. **`/foot_status`**
   - **Type**: `std_msgs/Bool[]`
   - **Purpose**: Contact status of each foot (e.g., `true` if the foot is touching the ground).

3. **`/center_of_mass`**
   - **Type**: `geometry_msgs/Point`
   - **Purpose**: Computed center of mass (CoM) of the robot in the body frame or global frame.

4. **`/foot_positions`**
   - **Type**: `hexapod_msgs/LegPositions`
   - **Purpose**: Current Cartesian positions of all feet relative to the robot's body frame.

5. **`/support_polygon`**
   - **Type**: `hexapod_msgs/Polygon`
   - **Purpose**: Polygon formed by the feet in contact with the ground.

6. **`/stability_margin`**
   - **Type**: `std_msgs/Float64`
   - **Purpose**: Stability margin of the robot based on the CoM and support polygon.

7. **`/polygon_centroid`**
   - **Type**: `geometry_msgs/Point`
   - **Purpose**: Centroid of the support polygon, used for stability analysis.

8. **`/leg_commands`**
   - **Type**: `hexapod_msgs/LegCommands`
   - **Purpose**: Desired Cartesian positions or trajectories for the feet, generated by a gait planner or controller.


## How to Use

### **1. Build the Workspace**

```bash
cd ros2_ws
colcon build
source install/setup.bash
```

### **2. Run Nodes**

- **Support Polygon Calculator**:  
  ```bash
  ros2 launch support_polygon_calculator support_polygon_calculator.launch.py
  ```  

- **Servo Control**:  
  ```bash
  ros2 launch servo_control servo_control.launch.py
  ```  

- **IMU Interface**:  
  ```bash
  ros2 launch imu_interface imu_interface.launch.py
  ```  

- **Foot Sensor Package**:  
  ```bash
  ros2 launch foot_sensor foot_sensor.launch.py
  ```  

- **Static Balancing Package**:  
  ```bash
  ros2 launch static_balancer static_balancer.launch.py
  ```  

